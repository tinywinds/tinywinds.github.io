<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          PHP使用JQuery, AJAX and JSONP实现跨域请求的例子 - Tinywind | 佚名程序员
        
    </title>

    <link rel="canonical" href="https://tsuixu.coding.me/php-jsonp.html">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                        </div>
                        <h1>PHP使用JQuery, AJAX and JSONP实现跨域请求的例子</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by Nathan on
                            2015-08-03
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">佚名程序员</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">主页</a>
                    </li>

                    

                        
                        <li>
                            <a href="/about/">关于</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">内容归档</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">标签列表</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <p>If you’ve ever needed to make a cross-domain call via AJAX you’ve probably run into the dreaded <a href="http://en.wikipedia.org/wiki/Same_origin_policy" target="_blank" rel="noopener">same origin policy</a>: _The policy permits scripts running on pages originating from the same site to access each other’s methods and properties with no specific restrictions, but prevents access to most methods and properties across pages on different sites._Today I’ll show you how you can use <a href="http://jquery.com/" target="_blank" rel="noopener">JQuery</a> to easily do this and I’ll do it with the additional help of <a href="http://php.net/" target="_blank" rel="noopener">PHP</a>.   <strong>Note:</strong> With HTML5 a method was formalized for this particular thing (cross-domain calls) and it’s known as the <strong>postMessage interface</strong>. It would be great to use this but sadly it’s not implemented on all browsers yet and of course HTML5 has yet to fully reach maturity so things can change (take a look at the <a href="http://www.google.com/search?ie=UTF-8&amp;q=websocket+changes" target="_blank" rel="noopener">recent changes</a> with WebSocket circa 2010 early 2011). The easy part is setting up a PHP page to listen for incoming data and send back a result. Not only will we send back data but we will also send back the function name we want to call on the client’s browser. Here is the PHP code:</p>
<p><code>&lt;!--?php</code></p>
<p><code>header(`</code>“content-type: text/javascript”<code></code>);`</p>
<p><code>if`</code>(isset(<code>$_GET</code>[<code>&#39;name&#39;</code>]) &amp;&amp; isset(<code>$_GET</code>[<code>&#39;callback&#39;</code>]))`</p>
<p><code>{</code></p>
<p><code>$obj`</code>—&gt;name =<code></code>$_GET<code>[</code>‘name’<code></code>];`</p>
<p><code>$obj`</code>-&gt;message =<code></code>“Hello “<code></code>.<code></code>$obj<code></code>-&gt;name;`</p>
<p><code>echo</code> <code>$_GET`</code>[<code>&#39;callback&#39;</code>].<code></code>‘(‘<code></code>. json_encode(<code>$obj</code>) .<code></code>‘);’<code></code>;`</p>
<p><code>}</code></p>
<p><code>?&gt;</code></p>
<p>You can see two parameters come in: <strong>name</strong> and <strong>callback</strong> The name is some user defined string, in this case I will use my actual name. I then format the response to be JavaScript. <strong>Note:</strong> Keep in mind when you go to test this that you put your HTML file on one site and the PHP file on a different one and that way you can assure it’s working. If you put both the PHP and HTML file on the same site JQuery will actually just default back to a regular AJAX call from what I’ve read. The HTML file is actually pretty simple as well if your familiar with JQuery AJAX:</p>
<p><code>&lt;`</code>title<code>&gt;JQuery JSONP&lt;/</code>title<code></code>&gt;`</p>
<p><code>&lt;`</code>script<code></code>src<code>=</code>“<a href="http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js&quot;``&gt;" target="_blank" rel="noopener">http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js&quot;``&gt;</a>&lt;/<code>script</code>&gt;`</p>
<p><code>&lt;`</code>script<code></code>&gt;`</p>
<p><code>$(document).ready(function(){</code></p>
<p><code>$(&quot;#useJSONP&quot;).click(function(){</code></p>
<p><code>$.ajax({</code></p>
<p><code>url: &#39;http://domain.com/jsonp-demo.php&#39;,</code></p>
<p><code>data: {name: &#39;Chad&#39;},</code></p>
<p><code>dataType: &#39;jsonp&#39;,</code></p>
<p><code>jsonp: &#39;callback&#39;,</code></p>
<p><code>jsonpCallback: &#39;jsonpCallback&#39;,</code></p>
<p><code>success: function(){</code></p>
<p><code>alert(&quot;success&quot;);</code></p>
<p><code>}</code></p>
<p><code>});</code></p>
<p><code>});</code></p>
<p><code>});</code></p>
<p><code>function jsonpCallback(data){</code></p>
<p><code>$(&#39;#jsonpResult&#39;).text(data.message);</code></p>
<p><code>}</code></p>
<p><code>&lt;/`</code>script<code></code>&gt;`</p>
<p><code>&lt;`</code>input<code></code>type<code>=</code>“button”<code></code>id<code>=</code>“useJSONP”<code></code>value<code>=</code>“Use JSONP”<code>&gt;&lt;</code>br<code>&gt;&lt;</code>br<code></code>&gt;`</p>
<p><code>&lt;`</code>span<code></code>id<code>=</code>“jsonpResult”<code>&gt;&lt;/</code>span<code></code>&gt;`</p>
<p>This creates a simple HTML page with a button and clicking on it produces the desired result (see below). There are two things to note here: 1. You need to set the <strong>dataType</strong> as <strong>jsonp</strong> 2. Setting <strong>jsonp</strong> to <strong>callback</strong> and then setting <strong>jsonpCallback</strong> to <strong>jsonpCallback</strong> makes the querystring look like this:</p>
<p><code>http://domain.com/jsonp-demo.php?callback=jsonpCallback&amp;name=Chad</code></p>
<p>Calling the PHP file with the proper querystring produces a result like this:</p>
<p><code>jsonpCallback({&quot;name&quot;:&quot;Chad&quot;,&quot;message&quot;:&quot;Hello Chad&quot;});</code></p>
<p>Running the code from the HTML page will simply display the results. <a href="http://www.giantflyingsaucer.com/blog/wp-content/uploads/2011/04/jsonp-ajax-jquery-php-1.jpg" target="_blank" rel="noopener"><img src="http://www.giantflyingsaucer.com/blog/wp-content/uploads/2011/04/jsonp-ajax-jquery-php-1.jpg" alt></a> <strong>Update Sept. 21, 2011:</strong> A reader pointed out he had some issues with the PHP code in this article and needed to add an additional header to get this to work. If your having issues please try adding these headers to your PHP code:</p>
<p><code>header(`</code>“content-type: Access-Control-Allow-Origin: *”<code></code>);`</p>
<p><code>header(`</code>“content-type: Access-Control-Allow-Methods: GET”<code></code>);`</p>
<p>Another thing to keep in mind if your using a hosting service or you don’t have complete control over the server that hosts your server side logic, it’s possible your host might block this type of thing (JSONP) as seen in the below Apache config:</p>
<p><code>Header set Access-Control-Allow-Origin &quot;mydomain.com&quot;</code></p>
<p>Make sure to check with your web host.</p>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/python-with.html" data-toggle="tooltip" data-placement="top" title="理解Python的With语句">&larr; 上一篇</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/ubuntu14-04-switch-python-version.html" data-toggle="tooltip" data-placement="top" title="ubuntu14.04 切换 python版本">下一篇 &rarr;</a>
                        </li>
                    
                </ul>

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>







<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Nathan 2019 
                    <br>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://tsuixu.coding.me/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->




<!-- Baidu Tongji -->






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://tsuixu.coding.me/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
